#!/usr/bin/env php
<?php

require_once __DIR__ . '/vendor/autoload.php';

try {
    $dotenv = Dotenv\Dotenv::createImmutable(__DIR__);
    $dotenv->load();
    
    echo "Environment variables loaded:\n";
    echo "DB_HOST=" . $_ENV['DB_HOST'] . "\n";
    echo "DB_PORT=" . $_ENV['DB_PORT'] . "\n";
    echo "DB_NAME=" . $_ENV['DB_NAME'] . "\n";
    echo "DB_USER=" . $_ENV['DB_USER'] . "\n";
    echo "DB_PASSWORD=" . (isset($_ENV['DB_PASSWORD']) ? '[SET]' : '[NOT SET]') . "\n\n";
} catch (\Exception $e) {
    echo "Error loading .env file: " . $e->getMessage() . "\n";
    exit(1);
}

require_once __DIR__ . '/core/Database.php';
require_once __DIR__ . '/core/Migration.php';
require_once __DIR__ . '/console/Migrate.php';

$migrator = new console\Migrate();

if (isset($argv[1]) && $argv[1] === 'rollback') {
    $migrator->rollback();
} else {
    $migrator->run();
}
